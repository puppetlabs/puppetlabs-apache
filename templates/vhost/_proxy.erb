<% if @proxy_dest or @proxy_pass -%>

  ## Proxy rules
  ProxyRequests Off
<%- end -%>
<% [@proxy_pass].flatten.compact.each do |proxy| %>
  <%- if proxy['url'] != '' -%>
    <%- if proxy['path'] and proxy['url'] != '' -%>
  ProxyPass <%= proxy['path'] %> <%= proxy['url'] %>
  <Location <%= proxy['path']%>>
    ProxyPassReverse /
  </Location>
    <%- elsif proxy['pathmatch'] and proxy['url'] != '' -%>
  ProxyPassMatch <%= proxy['pathmatch'] %> <%= proxy['url'] %>
  <Location <%= proxy['pathmatch']%>>
    ProxyPassReverse /
  </Location>
    <%- end -%>
  <%- end -%>
<% end %>
<% if @proxy_dest -%>
<% Array(@no_proxy_uris).each do |uri| %>
  ProxyPass        <%= uri %> !
<% end %>
  ProxyPass          / <%= @proxy_dest %>/
  <Location          />
    ProxyPassReverse /
  </Location>
<% end -%>
